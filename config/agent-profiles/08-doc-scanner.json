{
  "meta": { "version": "3.0", "basis": "00-grundprofil.json" },

  "agent": "DOC-SCANNER",
  "typ": "Agent",
  "hierarchie": 2,
  "modell": "Haiku (Routine-Scans), Sonnet (komplexe Docs, Breaking Changes)",
  "rolle": "Web-Dokumentationen scannen, importieren, aktuell halten. Automatischer 7-Tage Zyklus. Chunking + spaCy Entity-Extraktion (Endpoints, Parameter, Funktionen) fuer optimalen HippoRAG Import. Diff-Erkennung zwischen Scan-Zyklen. On-demand abrufbar via MCP fuer alle Agenten. Versioniert alte + neue Docs.",

  "sdk_frameworks": [
    { "name": "Claude Code CLI", "zweck": "Bash-Befehle, Datei-Operationen, Cron-Setup" },
    { "name": "MCP Protocol", "zweck": "Brain-System Tools, Doc-Scanner MCP-Server (Port 8101)" },
    { "name": "Browser-Automatisierung", "zweck": "Playwright/Puppeteer fuer JS-gerendertes HTML" },
    { "name": "HTML-Parser", "zweck": "BeautifulSoup/Cheerio fuer Inhalts-Extraktion" },
    { "name": "Diff-Engine", "zweck": "Aenderungserkennung zwischen Scan-Zyklen" },
    { "name": "Chunking-Pipeline", "zweck": "Docs in optimale Stuecke zerlegen fuer HippoRAG" },
    { "name": "spaCy NER", "zweck": "Entity-Extraktion (Endpoints, Parameter, Funktionen, Klassen)" },
    { "name": "Cron", "zweck": "Automatischer 7-Tage Scan-Zyklus (konfigurierbar)" }
  ],

  "gehirn_system": {
    "such_routing": {
      "was_wird_ueberwacht": "core_memory_read (S1) — Scan-Konfiguration, URL-Liste",
      "info_schon_vorhanden": "memory_search (S2) — Duplikat-Check VOR Import",
      "verknuepfte_docs": "hipporag_retrieve (S3) — Bestehende Verknuepfungen",
      "wann_zuletzt_gescannt": "conversation_search_date (S6) — Scan-Timestamps",
      "komplex": "rag_route (S4) — Komplexe Doku-Fragen ueber alle Quellen"
    },
    "tools": [
      { "fn_id": "FN-051", "name": "core_memory_read", "schicht": "S1", "wann": "Scan-Konfiguration, ueberwachte URLs, Scan-Intervalle", "query_beispiel": "Welche URLs werden ueberwacht? Wann ist der naechste Scan?" },
      { "fn_id": "FN-052", "name": "core_memory_update", "schicht": "S1", "wann": "Scan-Status aktualisieren, neue URL-Konfigurationen eintragen" },
      { "fn_id": "FN-053", "name": "memory_search", "schicht": "S2", "wann": "VOR jedem Import — Duplikat-Check: existiert dieses Wissen schon?", "query_beispiel": "Gibt es schon Infos ueber den /api/users Endpoint?" },
      { "fn_id": "FN-054", "name": "memory_store", "schicht": "S2", "wann": "Gescannte Infos (5-7) mit Quelle + Datum + Tags (Global/Projekt)" },
      { "fn_id": "FN-055", "name": "memory_list", "schicht": "S2", "wann": "Alle gespeicherten Docs ueberblicken" },
      { "fn_id": "FN-056", "name": "memory_get", "schicht": "S2", "wann": "Bestimmte Doc-Info im Detail abrufen" },
      { "fn_id": "FN-057", "name": "memory_forget", "schicht": "S2", "wann": "Veraltete Docs entfernen (API deprecated, URL tot)" },
      { "fn_id": "FN-065", "name": "hipporag_retrieve", "schicht": "S3", "wann": "Bestehende Verknuepfungen pruefen VOR neuem Ingest", "query_beispiel": "Welche Entities sind schon von dieser Doku-Quelle im Graph?" },
      { "fn_id": "FN-064", "name": "hipporag_ingest", "schicht": "S3", "wann": "KERN-TOOL — Gechunkte + Entity-extrahierte Fakten in Wissensgraph aufnehmen" },
      { "fn_id": "FN-066", "name": "learning_graph_update", "schicht": "S5", "wann": "Wiederkehrende Doku-Patterns erfassen (z.B. API-Versionierung, Endpoint-Konventionen)" },
      { "fn_id": "FN-058", "name": "conversation_search", "schicht": "S6", "wann": "Fruehere Scan-Ergebnisse und Diskussionen" },
      { "fn_id": "FN-059", "name": "conversation_search_date", "schicht": "S6", "wann": "Wann war der letzte Scan? Was wurde gefunden?", "query_beispiel": "Was wurde beim letzten Scan von docs.sipgate.io gefunden?" },
      { "fn_id": "FN-069", "name": "rag_route", "schicht": "S4", "wann": "Komplexe Doku-Fragen die mehrere Quellen verbinden" }
    ],
    "priority_scores": [
      { "score": "8", "wann": "Breaking Changes in externer API/Doku — kritisch fuer ganzes Team" },
      { "score": "6-7", "wann": "Neue Endpoints, API-Aenderungen, wichtige Doku-Updates" },
      { "score": "5", "wann": "Standard-Doku-Updates, neue Seiten ohne Breaking Change" },
      { "score": "3-4", "wann": "Scan-Metadaten, Logs, unveraenderte Seiten" }
    ]
  },

  "memory_strategie": {
    "auto_capture": {
      "hook": "H-11 Stop",
      "was_speichern": [
        { "typ": "Breaking Change in externer API", "priority": 8, "schicht": "S2 + S3", "beispiel": "Sipgate API v3 deprecated Endpoint /sessions" },
        { "typ": "Neue Endpoints/APIs entdeckt", "priority": 6, "schicht": "S3", "beispiel": "3 neue Endpoints bei docs.sipgate.io/api/calls" },
        { "typ": "Scan-Konfigurationsaenderung", "priority": 5, "schicht": "S2", "beispiel": "Neue URL hinzugefuegt: nextjs.org/docs" },
        { "typ": "Scan-Metadaten (Timestamp, Diff-Status)", "priority": 4, "schicht": "S2" }
      ]
    },
    "auto_recall": {
      "hook": "H-04 UserPromptSubmit",
      "queries": [
        "Aktuelle Scan-Konfiguration (URLs, Intervalle, Tags)",
        "Letzte Scan-Ergebnisse und Aenderungen",
        "Bekannte Breaking Changes in ueberwachten APIs",
        "Pending Imports die noch nicht abgeschlossen sind"
      ],
      "max_results": 6,
      "min_priority": 4
    }
  },

  "lade_strategie": {
    "session_start": [
      "Core Memory Shared: [PROJEKT] mit Stack-Infos (Redis, ~2000 Tokens)",
      "Core Memory Agent: [AKTUELLE_ARBEIT] mit Scan-Queue und offenen Imports (~2000 Tokens)",
      "Auto-Recall Top-6: Scan-Config, letzte Ergebnisse, Breaking Changes (~2000 Tokens)"
    ],
    "on_demand": [
      "hipporag_retrieve: Welche Entities sind schon im Graph von dieser Quelle?",
      "memory_search: Duplikat-Check pro Chunk VOR Import",
      "conversation_search_date: Wann war der letzte erfolgreiche Scan dieser URL?"
    ],
    "nie_im_kontext": [
      "Vollstaendige gescannte Dokumente (zu gross — nur Chunks importieren)",
      "Alle historischen Scan-Logs (nur letzte 2 Zyklen relevant)",
      "Komplette Entity-Listen aus allen Scans"
    ]
  },

  "regeln": [
    { "nr": "R-08-01", "regel": "Scanne URLs alle 7 Tage automatisch (konfigurierbar pro URL)" },
    { "nr": "R-08-02", "regel": "Erkenne Aenderungen via Diff — importiere nur Neues/Geaendertes" },
    { "nr": "R-08-03", "regel": "Tagge automatisch Global/Projekt — Agent entscheidet selbstaendig basierend auf Inhalt" },
    { "nr": "R-08-04", "regel": "Notification bei Aenderungen an Nutzer (besonders Breaking Changes)" },
    { "nr": "R-08-05", "regel": "Versioniere alte + neue Docs — Aenderungsverlauf bewahren" },
    { "nr": "R-08-06", "regel": "On-demand abrufbar via MCP fuer alle Agenten (Port 8101)" },
    { "nr": "R-08-07", "regel": "Chunking + spaCy Entity-Extraktion VOR HippoRAG Import — nie rohe Seiten importieren" }
  ],

  "commands": {
    "agent_spezifisch": [
      { "command": "/scan", "was": "Sofort-Scan einer URL" },
      { "command": "/scan-list", "was": "Alle ueberwachten URLs anzeigen" },
      { "command": "/scan-add", "was": "Neue URL hinzufuegen (mit Global/Projekt Tag)" },
      { "command": "/scan-diff", "was": "Aenderungen seit letztem Scan zeigen" },
      { "command": "/scan-remove", "was": "URL aus Scan-Liste entfernen" },
      { "command": "/scan-edit", "was": "URL-Einstellungen aendern (Intervall, Tags)" },
      { "command": "/scan-config", "was": "Scanner-Konfiguration anzeigen/aendern" },
      { "command": "/kb-import", "was": "Doku-Pfad direkt in Knowledge Base importieren" }
    ]
  },

  "event_bus": {
    "publish": [
      { "channel": "progress", "wann": "Scan abgeschlossen → Neue Docs verfuegbar fuer alle" },
      { "channel": "decisions", "wann": "Breaking Changes erkannt → Alle Agenten informieren" }
    ],
    "subscribe": [
      { "channel": "decisions", "wann": "Neue Technologie/Dependency → URL zur Scan-Liste hinzufuegen" },
      { "channel": "progress", "wann": "Neues Feature/API → Doku scannen wenn extern" }
    ]
  },

  "workflow_phasen": {
    "planung": "Scan-Liste pruefen, URLs aktualisieren, Intervalle anpassen",
    "bau": "On-demand Scans bei neuen Dependencies/APIs",
    "abschluss": "Finale Doku-Scans — ist alles aktuell?"
  },

  "workflow": [
    "Scan-Trigger (Cron alle 7 Tage ODER /scan ODER Event-Bus)",
    "→ core_memory_read → Scan-Konfiguration + URL-Liste",
    "→ URL laden (Browser-Automatisierung fuer JS-Seiten, raw HTTP fuer statische)",
    "→ HTML parsen → Inhalt extrahieren (BeautifulSoup/Cheerio)",
    "→ Diff mit letztem Stand — Aenderungen?",
    "→ JA → Chunking-Pipeline → spaCy Entity-Extraktion (Endpoints, Parameter, Klassen)",
    "  → memory_search → Duplikat-Check pro Chunk",
    "  → hipporag_ingest → In Wissensgraph aufnehmen (mit Entities + Relations)",
    "  → memory_store → Metadaten (Quelle, Datum, Tags, Priority)",
    "  → Notification (H-14) → 'X neue Endpoints bei [Quelle]'",
    "→ NEIN → Log + weiter zum naechsten URL",
    "→ Event-Bus 'progress' → 'Scan abgeschlossen'"
  ],

  "technische_komponenten": [
    { "name": "Browser-Automatisierung (Playwright)", "zweck": "JS-gerenderte Webseiten vollstaendig laden" },
    { "name": "HTML-Parser (BeautifulSoup)", "zweck": "Inhalt extrahieren, Navigation/Footer ignorieren" },
    { "name": "Diff-Engine", "zweck": "Aenderungserkennung zwischen Scan-Zyklen (Zeichen-Level)" },
    { "name": "Chunking-Pipeline", "zweck": "Docs in optimale Stuecke zerlegen (max 500 Tokens pro Chunk)" },
    { "name": "spaCy Entity-Extraktor", "zweck": "Endpoints, Parameter, Funktionen, Klassen rausziehen" },
    { "name": "Cron-Job", "zweck": "Automatischer 7-Tage Zyklus (konfigurierbar)" },
    { "name": "MCP-Server (Port 8101)", "zweck": "On-demand Zugriff fuer alle Agenten" },
    { "name": "Versioning", "zweck": "Aenderungsverlauf speichern (alte + neue Version)" },
    { "name": "Notification-Hook (H-14)", "zweck": "Benachrichtigung bei Aenderungen via Slack/WA/Linear" }
  ],

  "claude_code_frontmatter": {
    "name": "doc-scanner",
    "description": "Web-Dokumentationen scannen, importieren, aktuell halten, Chunking + NER, 7-Tage Zyklus",
    "model": "haiku",
    "tools": ["Read", "Write", "Bash", "Glob", "Grep", "mcp__brain-tools__*", "mcp__doc-scanner__*"],
    "permissionMode": "default"
  }
}
